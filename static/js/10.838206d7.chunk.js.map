{"version":3,"sources":["components/Uploader.js","pages/Home.js"],"names":["Dragger","Upload","Text","Typography","Border","styled","div","Image","img","Component","observer","imageStore","useStores","ref1","useRef","ref2","store","useLocalStore","width","height","setWidth","inputWidth","setHeight","inputHeight","serverFile","attributes","url","widthStr","heightStr","props","beforeUpload","file","window","test","name","size","message","error","setFile","setFilename","upload","then","console","log","catch","e","showUploadList","tip","spinning","isUploading","className","InboxOutlined","filename","copyable","tooltips","href","target","src","ref","onChange","current","value","placeholder","fullStr","Home","userStore","currentUser","type","Uploader"],"mappings":"ydAQQA,EAAYC,IAAZD,QACAE,EAASC,IAATD,KAEFE,EAASC,IAAOC,IAAV,KAMNC,EAAQF,IAAOG,IAAV,KAyGIC,EArGGC,aAAS,WAAO,IACxBC,EAAeC,cAAfD,WACFE,EAAOC,mBACPC,EAAOD,mBACPE,EAAQC,aAAc,iBAAO,CACjCC,MAAO,KACPC,OAAQ,KACRC,SAHiC,SAGxBC,GACPL,EAAME,MAAQG,GAEhBC,UANiC,SAMvBC,GACRP,EAAMG,OAASI,GAEjB,eACE,OAAOP,EAAME,MAAN,aAAoBF,EAAME,OAAU,IAE7C,gBACE,OAAOF,EAAMG,OAAN,aAAqBH,EAAMG,QAAW,IAE/C,cACE,OAAOR,EAAWa,WAAWC,WAAWC,IAAID,WAAWC,IAAM,gBAAkBV,EAAMW,SAAWX,EAAMY,eAUpGC,EAAQ,CACZC,aAAc,SAAAC,GAMZ,OADAC,OAAOD,KAAOA,EACT,4BAA4BE,KAAKF,EAAKG,MAIvCH,EAAKI,KAAO,SACdC,IAAQC,MAAM,6DACP,IAET1B,EAAW2B,QAAQP,GACnBpB,EAAW4B,YAAYR,EAAKG,MAC5BvB,EAAW6B,SACRC,MAAK,SAACjB,GAAiBkB,QAAQC,IAAI,2BAAQnB,MAC3CoB,OAAM,SAACC,GAAQH,QAAQC,IAAI,2BAAQE,OAC/B,IAZLT,IAAQC,MAAM,+CACP,IAaXS,gBAAgB,GAGlB,OACE,6BACE,kBAAC,IAAD,CAAMC,IAAI,qBAAMC,SAAUrC,EAAWsC,aACnC,kBAACjD,EAAY6B,EACX,uBAAGqB,UAAU,wBACX,kBAACC,EAAA,EAAD,OAEF,uBAAGD,UAAU,mBAAb,iGACA,uBAAGA,UAAU,mBAAb,mDAGJ,6BAGIvC,EAAWa,WAAa,kBAACpB,EAAD,KACtB,4BAAKO,EAAWyC,UAChB,4BACE,2DACA,4BACE,kBAAClD,EAAD,CAAMmD,SAAU,CAAEC,SAAU,CAAC,eAAM,+BAChC3C,EAAWa,WAAWC,WAAWC,IAAID,WAAWC,MAGrD,2DACA,4BACE,uBAAG6B,KAAM5C,EAAWa,WAAWC,WAAWC,IAAID,WAAWC,IAAK8B,OAAO,UAAS,kBAACjD,EAAD,CAAOkD,IAAK9C,EAAWa,WAAWC,WAAWC,IAAID,WAAWC,QAE5I,iEACA,4BACE,2BAAOgC,IAAK7C,EAAM8C,SA7DZ,WAClB3C,EAAMI,SAASP,EAAK+C,QAAQC,QA4DyBC,YAAY,uDACrD,2BAAOJ,IAAK3C,EAAM4C,SA3DX,WACnB3C,EAAMM,UAAUP,EAAK6C,QAAQC,QA0DyBC,YAAY,wDAExD,4BAAK9C,EAAMG,QAAUH,EAAME,MAAQ,+DAAe,MAClD,4BACGF,EAAMG,QAAUH,EAAME,MACrB,uBAAGsC,OAAO,SAASD,KAAMvC,EAAM+C,SAAU/C,EAAM+C,QAA/C,KAA+D,QAG3D,U,SC3GhBC,EAAOtD,aAAS,WAAO,IACnBuD,EAAcrD,cAAdqD,UAER,OACE,oCAEIA,EAAUC,YAAc,KAAO,kBAAC,IAAD,CAAO9B,QAAQ,+DAAa+B,KAAK,YAElE,6BACA,kBAACC,EAAD,UAKSJ","file":"static/js/10.838206d7.chunk.js","sourcesContent":["import React, { useRef } from 'react'\r\nimport { useStores } from '../stores'\r\nimport { observer, useLocalStore } from 'mobx-react'\r\nimport { Upload, message, Typography, Spin } from 'antd';\r\nimport { InboxOutlined } from '@ant-design/icons';\r\nimport styled from 'styled-components'\r\n// import { userStore } from '../stores/user';\r\n\r\nconst { Dragger } = Upload;\r\nconst { Text } = Typography;\r\n\r\nconst Border = styled.div`\r\nmargin-top:20px;\r\nborder:1px dashed #d9d9d9;\r\npadding:20px;\r\nbackground:#fafafa\r\n`\r\nconst Image = styled.img`\r\nmax-width:250px;\r\n`\r\n\r\nconst Component = observer(() => {\r\n  const { imageStore } = useStores()\r\n  const ref1 = useRef();\r\n  const ref2 = useRef();\r\n  const store = useLocalStore(() => ({\r\n    width: null,\r\n    height: null,\r\n    setWidth(inputWidth) {\r\n      store.width = inputWidth;\r\n    },\r\n    setHeight(inputHeight) {\r\n      store.height = inputHeight;\r\n    },\r\n    get widthStr() {\r\n      return store.width ? `/w/${store.width}` : '';\r\n    },\r\n    get heightStr() {\r\n      return store.height ? `/h/${store.height}` : '';\r\n    },\r\n    get fullStr() {\r\n      return imageStore.serverFile.attributes.url.attributes.url + '?imageView2/0' + store.widthStr + store.heightStr\r\n    }\r\n  }));\r\n  const changeWidth = () => {\r\n    store.setWidth(ref1.current.value);\r\n  };\r\n  const changeHeight = () => {\r\n    store.setHeight(ref2.current.value);\r\n  };\r\n\r\n  const props = {\r\n    beforeUpload: file => {\r\n      // if (userStore.currentUser === null) {\r\n      //   message.warning('请先登录再上传！');\r\n      //   return false\r\n      // }\r\n      window.file = file\r\n      if (!/\\.(gif|jpg|jpeg|png|svg)$/.test(file.name)) {\r\n        message.error('只能上传图片！');\r\n        return false\r\n      }\r\n      if (file.size > 2048 * 2048) {\r\n        message.error('上传图片不能大于2M！');\r\n        return false\r\n      }\r\n      imageStore.setFile(file)\r\n      imageStore.setFilename(file.name)\r\n      imageStore.upload()\r\n        .then((serverFile) => { console.log('上传成功', serverFile) })\r\n        .catch((e) => { console.log('上传失败', e) })\r\n      return false;\r\n    },\r\n    showUploadList: false //隐藏上传文件列表\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <Spin tip='上传中' spinning={imageStore.isUploading}>\r\n        <Dragger {...props}>\r\n          <p className=\"ant-upload-drag-icon\">\r\n            <InboxOutlined />\r\n          </p>\r\n          <p className=\"ant-upload-text\">点击选择图片 / 将图片拖入此虚线框</p>\r\n          <p className=\"ant-upload-hint\">支持 JPG/PNG/BMP/GIF/SVG 格式</p>\r\n        </Dragger>\r\n      </Spin>\r\n      <div>\r\n        {/* 调试用window.stores.serverFile找url路径 */}\r\n        {\r\n          imageStore.serverFile ? <Border>\r\n            <h2>{imageStore.filename}</h2>\r\n            <dl>\r\n              <dt>在线地址 : </dt>\r\n              <dd>\r\n                <Text copyable={{ tooltips: ['复制', '复制成功!'] }}>\r\n                  {imageStore.serverFile.attributes.url.attributes.url}\r\n                </Text>\r\n              </dd>\r\n              <dt>图片预览 : </dt>\r\n              <dd>\r\n                <a href={imageStore.serverFile.attributes.url.attributes.url} target='_blank'><Image src={imageStore.serverFile.attributes.url.attributes.url} /></a>\r\n              </dd>\r\n              <dt>自定义尺寸 : </dt>\r\n              <dd>\r\n                <input ref={ref1} onChange={changeWidth} placeholder=\"最大宽度px（可选）\" />\r\n                <input ref={ref2} onChange={changeHeight} placeholder=\"最大高度px（可选）\" />\r\n              </dd>\r\n              <dt>{store.height || store.width ? '点击查看自定义图片：' : null}</dt>\r\n              <dd>\r\n                {store.height || store.width ?\r\n                  <a target=\"_blank\" href={store.fullStr}>{store.fullStr} </a> : null}\r\n              </dd>\r\n            </dl>\r\n          </Border> : null\r\n        }\r\n      </div>\r\n\r\n    </div >\r\n  )\r\n})\r\n\r\nexport default Component\r\n\r\n","import React from 'react'\r\nimport { observer } from 'mobx-react'\r\nimport { useStores } from '../stores'\r\nimport Uploader from '../components/Uploader'\r\nimport { Alert } from 'antd'\r\n\r\n\r\nconst Home = observer(() => {\r\n  const { userStore } = useStores();\r\n\r\n  return (\r\n    <>\r\n      {\r\n        userStore.currentUser ? null : <Alert message=\"登录后可保存上传记录\" type=\"warning\" />\r\n      }\r\n      <br />\r\n      <Uploader />\r\n    </>\r\n  )\r\n})\r\n\r\nexport default Home"],"sourceRoot":""}